<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Batsd::Handler::Gauge
  
    &mdash; Documentation by YARD 0.8.1
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Batsd.html" title="Batsd (module)">Batsd</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Handler.html" title="Batsd::Handler (class)">Handler</a></span></span>
     &raquo; 
    <span class="title">Gauge</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Batsd::Handler::Gauge
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Handler.html" title="Batsd::Handler (class)">Batsd::Handler</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="../Handler.html" title="Batsd::Handler (class)">Batsd::Handler</a></span></li>
          
            <li class="next">Batsd::Handler::Gauge</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/batsd/handlers/gauge.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Handles gauge measurements ("|g")</p>

<p>Gauge measurements are never aggregated, and are only stored on disk. They
are written to disk immediately upon receipt and without manipulation
beyond correcting  for sample rate (or more accurately, scale), if
provided.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle-instance_method" title="#handle (instance method)">- (Object) <strong>handle</strong>(key, value, sample_rate) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Process an incoming gauge measurement.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Gauge) <strong>initialize</strong>(options) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set up a new handler to handle gauges.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Handler.html" title="Batsd::Handler (class)">Batsd::Handler</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Handler.html#statistics-instance_method" title="Batsd::Handler#statistics (method)">#statistics</a></span>, <span class='object_link'><a href="../Handler.html#threadpool-instance_method" title="Batsd::Handler#threadpool (method)">#threadpool</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Batsd::Handler::Gauge (class)">Gauge</a></span></tt>) <strong>initialize</strong>(options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set up a new handler to handle gauges</p>
<ul><li>
<p>Set up a redis client</p>
</li><li>
<p>Set up a diskstore client to write aggregates to disk</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/batsd/handlers/gauge.rb', line 17</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_@redis ivar id'>@redis</span> <span class='assign token'>=</span> <span class='rubyid_Batsd constant id'>Batsd</span><span class='colon2 op'>::</span><span class='rubyid_Redis constant id'>Redis</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='rubyid_@diskstore ivar id'>@diskstore</span> <span class='assign token'>=</span> <span class='rubyid_Batsd constant id'>Batsd</span><span class='colon2 op'>::</span><span class='rubyid_Diskstore constant id'>Diskstore</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:root</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_super super kw'>super</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="handle-instance_method">
  
    - (<tt>Object</tt>) <strong>handle</strong>(key, value, sample_rate) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Process an incoming gauge measurement</p>
<ul><li>
<p>Normalize for sample rate provided</p>
</li><li>
<p>Write current timestamp and value to disk</p>
</li><li>
<p>Store the name of the datapoint in Redis</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/batsd/handlers/gauge.rb', line 29</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_handle identifier id'>handle</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_sample_rate identifier id'>sample_rate</span><span class='rparen token'>)</span>
  <span class='rubyid_@threadpool ivar id'>@threadpool</span><span class='dot token'>.</span><span class='rubyid_queue identifier id'>queue</span> <span class='rubyid_Time constant id'>Time</span><span class='dot token'>.</span><span class='rubyid_now identifier id'>now</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_sample_rate identifier id'>sample_rate</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_timestamp identifier id'>timestamp</span><span class='comma token'>,</span> <span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_sample_rate identifier id'>sample_rate</span><span class='bitor op'>|</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Received #{key} #{value} #{sample_rate}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;VVERBOSE&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_sample_rate identifier id'>sample_rate</span>
      <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_f identifier id'>to_f</span> <span class='div op'>/</span> <span class='rubyid_sample_rate identifier id'>sample_rate</span><span class='dot token'>.</span><span class='rubyid_gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;@&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_f identifier id'>to_f</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{timestamp} #{value}&quot;</span>
    <span class='rubyid_key identifier id'>key</span>   <span class='assign token'>=</span> <span class='dstring node'>&quot;gauges:#{key}&quot;</span>
    <span class='rubyid_@diskstore ivar id'>@diskstore</span><span class='dot token'>.</span><span class='rubyid_append_value_to_file identifier id'>append_value_to_file</span><span class='lparen token'>(</span><span class='rubyid_@diskstore ivar id'>@diskstore</span><span class='dot token'>.</span><span class='rubyid_build_filename identifier id'>build_filename</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='rubyid_@redis ivar id'>@redis</span><span class='dot token'>.</span><span class='rubyid_add_datapoint identifier id'>add_datapoint</span> <span class='rubyid_key identifier id'>key</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon May 28 06:37:20 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.1 (ruby-1.9.3).
</div>

  </body>
</html>